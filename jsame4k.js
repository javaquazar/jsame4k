!function(){function o(o){return{x:o.clientX-$.getBoundingClientRect().left,y:o.clientY-$.getBoundingClientRect().top}}function t(o){for(var t=1;t<arguments.length;t++)o=o.replace(/%s/,arguments[t]);return o}function e(o){var t=o>>16,e=o>>8&255,r=255&o;return[t,e,r]}function r(o){var t=o[0]<<16|o[1]<<8|o[2];return"#"+function(o){return Array(7-o.length).join("0")+o}(t.toString(16))}function x(o){var t=o[0],e=o[1],r=o[2],x=Math.floor(1/(1-L));return 0==t&&0==e&&0==r?[x,x,x]:(t>0&&x>t&&(t=x),e>0&&x>e&&(e=x),r>0&&x>r&&(r=x),[Math.min(Math.floor(t/L),255),Math.min(Math.floor(e/L),255),Math.min(Math.floor(r/L),255)])}function n(o){return[Math.max(Math.floor(o[0]*L,0)),Math.max(Math.floor(o[1]*L,0)),Math.max(Math.floor(o[2]*L,0))]}function f(){j=Array(2*C.length-1);for(var o=0;o<C.length;o++)j[o]=i(e(C[o]),!0),j[2*C.length-2-o]=i(e(C[o]),!1)}function i(o,t){var e=document.createElement("canvas");e.width=m,e.height=m;var f=e.getContext("2d"),i=t?x(o):o,c=x(i),a=n(i);f.fillStyle=r(a),f.fillRect(0,0,m,m),f.fillStyle=r(i),f.fillRect(0,0,m-1,m-1),f.fillStyle=r(c),f.fillRect(1,1,m-3,m-3);var y=f.createLinearGradient(2,2,m-4,m-4);return y.addColorStop(0,r(i)),y.addColorStop(1,r(c)),f.fillStyle=y,f.fillRect(2,2,m-4,m-4),t&&(f.fillStyle=r(a),f.fillRect(8,8,m-16,m-16)),e}function c(){z.fillStyle="#262c4b",z.fillRect(0,0,P*m+2*V,M*m+2*V),z.fillStyle="#484d50",z.fillRect(0,M*m+2*V,P*m+2*V,Z),z.font="bold 12px sans-serif",S[1]=E>1?t("Marked: %s (%s points)",E,k(E)):R?"":"Game Over!",S[2]=t("Score: %s",O);for(var o=0;o<S.length;o++)z.fillStyle="#62696a",z.fillRect(Math.floor((P*m+2*V)/3)*o+1,M*m+2*V+1,Math.floor((P*m+2*V)/3)-2,Z-2),z.fillStyle="#ffffff",z.fillText(S[o],Math.floor((P*m+2*V)/6)*(2*o+1)-Math.floor(z.measureText(S[o]).width/2),M*m+2*V+Math.floor(Z/2)+4);for(var e=0;P>e;e++)for(var r=0;M>r;r++)z.drawImage(j[w[P*r+e]+Y],e*m+V,r*m+V)}function a(){E=0,O=0,A=!1,R=!0;for(var o=0;o<w.length;o++)w[o]=Math.floor(Math.random()*Y+1)}function y(o,t){return 0>o||0>t||o>P-1||t>M-1?0:w[P*t+o]}function v(o,t){return y(o,t)<0}function l(o,t){return 0==y(o,t)}function q(o,t){return y(o,t)<0?-1*y(o,t):y(o,t)}function k(o){return o*o-4*o+4}function p(o,t){return s(o,t,q(o,t))}function s(o,t,e){if(v(o,t)||e!=q(o,t)||l(o,t))return 0;var r=1;return w[P*t+o]=-1*q(o,t),r+=s(o-1,t,q(o,t)),r+=s(o,t-1,q(o,t)),r+=s(o+1,t,q(o,t)),r+=s(o,t+1,q(o,t))}function h(){for(var o=0;o<w.length;o++)w[o]=w[o]<0?-1*w[o]:w[o]}function g(o,t,e,r){var x=P*t+o,n=P*r+e,f=w[x];w[x]=w[n],w[n]=f}function u(t,e){var r=o(t),x=r.x<V?-1:Math.floor((r.x-V)/m),n=r.y<V?-1:Math.floor((r.y-V)/m);if((T.x!=x||T.y!=n)&&!v(x,n)||e){if(l(x,n)&&l(T.x,T.y))return T.x=x,void(T.y=n);h(),E=p(x,n),c(),T.x=x,T.y=n}}function b(t,e){var r=o(t),x=r.x<V?-1:Math.floor((r.x-V)/m),n=r.y<V?-1:Math.floor((r.y-V)/m);(T.x!=x||T.y!=n||e)&&(h(),E=0,c(),T.x=x,T.y=n)}function d(){$=document.getElementById("jsame4k"),null!=$&&$.getContext&&(z=$.getContext("2d"),f(),w=Array(P*M),T={x:-1,y:-1},S=["New Game","",""],a(),c(),$.addEventListener("mousedown",function(t){var e,r,x,n,f=o(t);f.x>0&&f.x<Math.floor((P*m+2*V)/3)-1&&f.y>M*m+2*V&&f.y<M*m+2*V+Z-1&&(a(),R=!0,E=0,c());var i=f.x<V?-1:Math.floor((f.x-V)/m),y=f.y<V?-1:Math.floor((f.y-V)/m);for(r=0,x=0;x<w.length;x++)w[x]<0&&r++;if(r>=2){for(x=0;x<w.length;x++)w[x]<0&&(w[x]=0);for(n=0;P>n;n++)for(e=!0;e;)for(e=!1,f=1;M>f;f++)l(n,f)&&!l(n,f-1)&&(g(n,f,n,f-1),e=!0);for(e=!0;e;)for(e=!1,n=1;P>n;n++)if(l(n-1,M-1)&&!l(n,M-1)){for(f=0;M>f;f++)g(n,f,n-1,f);e=!0}for(O+=k(r),e=!0,r=0,x=0;P>x;x++)for(n=0;M>n;n++)if(!l(x,n)&&(r++,f=q(x,n),q(x-1,n)==f||q(x,n-1)==f||q(x+1,n)==f||q(x,n+1)==f)){e=!1;break}0!=r||A||(A=!0,O+=1e3),E=0,e||(E=p(i,y)),e&&R&&(R=!1,E=0),c()}},!1),$.addEventListener("mouseup",function(o){u(o,!0)},!1),$.addEventListener("mousemove",function(o){u(o,!1)},!1),$.addEventListener("mouseover",function(o){u(o,!1)},!1),$.addEventListener("mouseout",function(o){b(o,!0)},!1))}var j,w,S,$,z,R,T,O,E,A,P=20,M=15,m=26,Z=20,V=4,C=[9522747,8094582,4022919,11503186,2501707],L=.7,Y=C.length-1;d()}();
